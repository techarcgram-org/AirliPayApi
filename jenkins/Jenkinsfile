pipeline {
    def buildNumber = env.BUILD_NUMBER as int
    if (buildNumber > 1) milestone(buildNumber - 1)
    milestone(buildNumber)
    
    agent any
    environment {
        CI = 'true'

    }
    stages {
        stage('Build') {
            steps {
                sh 'docker compose -f docker/production/docker-compose.yml build'
            }
        }
        stage('Deliver') {
            steps {
                sh 'docker compose -f docker/production/docker-compose.yml up --force-recreate'
            }
        }
    }
}